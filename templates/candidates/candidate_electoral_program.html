{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-top: 2rem;
    }
    .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }
    .btn-primary:hover {
        background-color: var(--primary-dark);
        border-color: var(--primary-dark);
    }
    .section-header {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin: 2rem 0 1rem 0;
        text-align: center;
    }
    .form-section {
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        background: #f8f9fa;
    }
    .character-counter {
        float: left;
        font-size: 0.85rem;
        margin-top: 0.25rem;
    }
    .preview-section {
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 1.5rem;
        margin-top: 1rem;
    }
    .preview-content {
        white-space: pre-wrap;
        line-height: 1.6;
    }
    .tabs-container {
        margin-bottom: 2rem;
    }
    .nav-tabs .nav-link {
        color: var(--primary-color);
        border-color: transparent;
    }
    .nav-tabs .nav-link.active {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    .tab-content {
        padding: 2rem 0;
    }
    .tips-box {
        background: #e8f5e8;
        border: 1px solid var(--primary-light);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
    }
    .tips-box h6 {
        color: var(--primary-dark);
        margin-bottom: 0.5rem;
    }
    .tips-box ul {
        margin-bottom: 0;
        padding-right: 1.5rem;
    }
    .tips-box li {
        margin-bottom: 0.25rem;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h2 class="my-4 text-center">{{ page_title }}</h2>
    
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="form-container">
                <!-- Navigation Tabs -->
                <div class="tabs-container">
                    <ul class="nav nav-tabs" id="programTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="edit-tab" data-bs-toggle="tab" data-bs-target="#edit-pane" type="button" role="tab">
                                <i class="fas fa-edit"></i> تحرير البرنامج
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="preview-tab" data-bs-toggle="tab" data-bs-target="#preview-pane" type="button" role="tab">
                                <i class="fas fa-eye"></i> معاينة البرنامج
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="tips-tab" data-bs-toggle="tab" data-bs-target="#tips-pane" type="button" role="tab">
                                <i class="fas fa-lightbulb"></i> نصائح للكتابة
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="tab-content" id="programTabsContent">
                    <!-- Edit Tab -->
                    <div class="tab-pane fade show active" id="edit-pane" role="tabpanel">
                        <form method="post" id="electoralProgramForm">
                            {% csrf_token %}
                            
                            <div class="section-header">
                                <h4><i class="fas fa-file-alt"></i> البرنامج الانتخابي</h4>
                            </div>
                            
                            <div class="form-section">
                                <div class="mb-3">
                                    <label for="electoral_program" class="form-label">
                                        <strong>البرنامج الانتخابي المفصل</strong>
                                    </label>
                                    <textarea 
                                        class="form-control" 
                                        id="electoral_program" 
                                        name="electoral_program" 
                                        rows="20" 
                                        placeholder="اكتب برنامجك الانتخابي المفصل هنا...

يمكنك تنظيم برنامجك في أقسام مثل:

1. الرؤية والأهداف العامة
2. التعليم والتطوير
3. الصحة والخدمات الاجتماعية
4. الاقتصاد والاستثمار
5. البنية التحتية والمواصلات
6. البيئة والتنمية المستدامة
7. الأمن والعدالة
8. الثقافة والرياضة

استخدم تنسيق واضح مع عناوين وأرقام لتسهيل القراءة."
                                        maxlength="5000">{{ candidate.electoral_program }}</textarea>
                                    <div class="character-counter text-muted" id="programCounter">
                                        <span id="programCount">{{ candidate.electoral_program|length|default:0 }}</span> / 5000 حرف
                                    </div>
                                </div>
                            </div>

                            <div class="section-header">
                                <h4><i class="fas fa-heart"></i> كلمة للمنتخبين</h4>
                            </div>
                            
                            <div class="form-section">
                                <div class="mb-3">
                                    <label for="message_to_voters" class="form-label">
                                        <strong>رسالة شخصية للمواطنين</strong>
                                    </label>
                                    <textarea 
                                        class="form-control" 
                                        id="message_to_voters" 
                                        name="message_to_voters" 
                                        rows="6" 
                                        placeholder="اكتب رسالة شخصية ومؤثرة للمواطنين تعبر عن التزامك وشغفك لخدمتهم..."
                                        maxlength="1000">{{ candidate.message_to_voters }}</textarea>
                                    <div class="character-counter text-muted" id="messageCounter">
                                        <span id="messageCount">{{ candidate.message_to_voters|length|default:0 }}</span> / 1000 حرف
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg px-5">
                                    <i class="fas fa-save"></i> حفظ البرنامج الانتخابي
                                </button>
                                <a href="{% url 'candidates:candidate_dashboard' %}" class="btn btn-secondary btn-lg px-5 ms-3">
                                    <i class="fas fa-arrow-right"></i> العودة للوحة التحكم
                                </a>
                            </div>
                        </form>
                    </div>

                    <!-- Preview Tab -->
                    <div class="tab-pane fade" id="preview-pane" role="tabpanel">
                        <div class="section-header">
                            <h4><i class="fas fa-eye"></i> معاينة البرنامج الانتخابي</h4>
                        </div>
                        
                        <div class="preview-section">
                            <h5 class="text-primary mb-3">البرنامج الانتخابي</h5>
                            <div class="preview-content" id="programPreview">
                                {% if candidate.electoral_program %}
                                    {{ candidate.electoral_program }}
                                {% else %}
                                    <em class="text-muted">لم يتم إضافة برنامج انتخابي بعد...</em>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="preview-section">
                            <h5 class="text-primary mb-3">كلمة للمنتخبين</h5>
                            <div class="preview-content" id="messagePreview">
                                {% if candidate.message_to_voters %}
                                    {{ candidate.message_to_voters }}
                                {% else %}
                                    <em class="text-muted">لم يتم إضافة رسالة للمنتخبين بعد...</em>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Tips Tab -->
                    <div class="tab-pane fade" id="tips-pane" role="tabpanel">
                        <div class="section-header">
                            <h4><i class="fas fa-lightbulb"></i> نصائح لكتابة برنامج انتخابي فعال</h4>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="tips-box">
                                    <h6><i class="fas fa-bullseye"></i> وضوح الأهداف</h6>
                                    <ul>
                                        <li>حدد أهدافاً واقعية وقابلة للتحقيق</li>
                                        <li>استخدم أرقام ومؤشرات محددة</li>
                                        <li>اربط الأهداف بالواقع المحلي</li>
                                        <li>ضع جدولاً زمنياً واضحاً</li>
                                    </ul>
                                </div>
                                
                                <div class="tips-box">
                                    <h6><i class="fas fa-users"></i> التواصل مع المواطنين</h6>
                                    <ul>
                                        <li>استخدم لغة بسيطة ومفهومة</li>
                                        <li>تحدث عن مشاكل حقيقية يواجهها المواطنون</li>
                                        <li>اذكر قصص نجاح من تجاربك السابقة</li>
                                        <li>أظهر شغفك وحماسك للخدمة</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="tips-box">
                                    <h6><i class="fas fa-list-ol"></i> تنظيم المحتوى</h6>
                                    <ul>
                                        <li>قسم البرنامج إلى مجالات واضحة</li>
                                        <li>استخدم عناوين فرعية وترقيم</li>
                                        <li>اكتب فقرات قصيرة ومترابطة</li>
                                        <li>استخدم النقاط والقوائم</li>
                                    </ul>
                                </div>
                                
                                <div class="tips-box">
                                    <h6><i class="fas fa-check-circle"></i> المصداقية والشفافية</h6>
                                    <ul>
                                        <li>اذكر مصادر تمويل مشاريعك</li>
                                        <li>كن صادقاً حول التحديات المتوقعة</li>
                                        <li>اعترف بالقيود والصعوبات</li>
                                        <li>قدم بدائل وخطط احتياطية</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tips-box">
                            <h6><i class="fas fa-star"></i> المجالات الأساسية التي يجب تغطيتها</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <ul>
                                        <li>التعليم والتطوير</li>
                                        <li>الصحة والخدمات الطبية</li>
                                        <li>الاقتصاد وفرص العمل</li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <ul>
                                        <li>البنية التحتية والمواصلات</li>
                                        <li>الأمن والسلامة</li>
                                        <li>البيئة والتنمية المستدامة</li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <ul>
                                        <li>الخدمات الاجتماعية</li>
                                        <li>الثقافة والرياضة</li>
                                        <li>الإسكان والتطوير العمراني</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const programTextarea = document.getElementById('electoral_program');
        const messageTextarea = document.getElementById('message_to_voters');
        const programCounter = document.getElementById('programCount');
        const messageCounter = document.getElementById('messageCount');
        const programPreview = document.getElementById('programPreview');
        const messagePreview = document.getElementById('messagePreview');

        // Character counters
        function updateCounter(textarea, counter, max) {
            const count = textarea.value.length;
            counter.textContent = count;
            
            const parent = counter.parentElement;
            parent.classList.remove('text-muted', 'text-warning', 'text-danger');
            
            if (count > max * 0.9) {
                parent.classList.add('text-danger');
            } else if (count > max * 0.8) {
                parent.classList.add('text-warning');
            } else {
                parent.classList.add('text-muted');
            }
        }

        // Live preview updates
        function updatePreview(textarea, preview) {
            const content = textarea.value.trim();
            if (content) {
                preview.textContent = content;
                preview.classList.remove('text-muted');
            } else {
                preview.innerHTML = '<em class="text-muted">لم يتم إضافة محتوى بعد...</em>';
            }
        }

        // Event listeners
        programTextarea.addEventListener('input', function() {
            updateCounter(this, programCounter, 5000);
            updatePreview(this, programPreview);
        });

        messageTextarea.addEventListener('input', function() {
            updateCounter(this, messageCounter, 1000);
            updatePreview(this, messagePreview);
        });

        // Form validation
        document.getElementById('electoralProgramForm').addEventListener('submit', function(e) {
            const program = programTextarea.value.trim();
            const message = messageTextarea.value.trim();
            
            if (!program && !message) {
                e.preventDefault();
                alert('يرجى إضافة محتوى في أحد الحقول على الأقل');
                return false;
            }
            
            if (program.length > 5000) {
                e.preventDefault();
                alert('البرنامج الانتخابي يتجاوز الحد المسموح (5000 حرف)');
                programTextarea.focus();
                return false;
            }
            
            if (message.length > 1000) {
                e.preventDefault();
                alert('رسالة المنتخبين تتجاوز الحد المسموح (1000 حرف)');
                messageTextarea.focus();
                return false;
            }
        });

        // Initialize counters
        updateCounter(programTextarea, programCounter, 5000);
        updateCounter(messageTextarea, messageCounter, 1000);
    });
</script>
{% endblock %}

